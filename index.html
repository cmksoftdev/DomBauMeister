<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Title</title>
</head>

<body>
    <p id="app"></p>
    <script src="javascript/library.js"></script>
    <script>

        // Create array of elements
        function getDom() {
            const pos = positionOfU.get();
            const elements = [
                {
                    type: "div",
                    style: "position:fixed;width:100%;height:80%;",
                    content: [
                        {
                            type: "div",
                            extend: {
                                class: ".testclass"
                            },
                            content: [
                                {
                                    type: "h1",
                                    content: "Uberschrift",
                                    id: "u"
                                }],
                            style: "position: absolute;left:" + pos.x + "px;top:" + pos.y + "px;",
                            id: "uc"
                        },
                        {
                            type: "div",
                            content: [
                                {
                                    type: "div",
                                    content: "test2",
                                    style: "color:blue;"
                                },
                                {
                                    type: "div",
                                    content: "test2"
                                },
                            ],
                            id: "test1"
                        },
                        {
                            type: "div",
                            content: "test2",
                            id: "test2"
                        },
                        {
                            type: "div",
                            content: "test3",
                            id: "test3"
                        },
                        {
                            type: "div",
                            content: "test4",
                            id: "test4"
                        },
                    ],
                    id: "main"
                },

            ];
            return createDOM(elements);
        }
        const position = new Property(false);
        let oldPosition = { x: 0, y: 0 };
        const positionOfU = new Property({x: 0, y: 0}, () => render());
        const isDown = new Property(false);

        // Create ActionManager
        const actionManager = new ActionManager();

        // Create DOM from array and render
        function render() {
            renderDOM("app", getDom(), [
                () => {
                    addMouseMoveEvent("main", (event) => {
                        event.preventDefault();
                        actionManager.callAction("mousemove", event);
                    });
                    addEvent("main", "blur",(event) => {
                        event.preventDefault();
                        actionManager.callAction("mousedown", event);
                    });
                    addMouseDownEvent("main", (event) => {
                        event.preventDefault();
                        actionManager.callAction("mousedown", event);
                    });
                    addMouseUpEvent("main", (event) => {
                        event.preventDefault();
                        actionManager.callAction("mouseup", event);
                    });
                }]);
        }
        render();

        // Add action and functions to invoke
        actionManager.addAction("mousemove", [
            (event) => {
                if (isDown.get()) {
                    let posi = getMousePosition(event);
                    const delta = { x: oldPosition.x - posi.x, y: oldPosition.y - posi.y };
                    posi = { x: posi.x, y: posi.y }
                    positionOfU.set(posi);
                    oldPosition = positionOfU.get();
                }
            },
        ]);
        actionManager.addAction("mousedown", [
            () => { isDown.set(true); },
        ]);
        actionManager.addAction("mouseup", [
            () => { isDown.set(false); },
        ]);
    </script>
</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Title</title>
</head>

<body>
    <p id="app"></p>
    <p id="app2"></p>
    <script src="javascript/library.js"></script>
    <script src="javascript/viewtemplates.js"></script>
    <script>
        // Create array of elements
        function getDom(pos) {
            const elements = [
                {
                    type: "div",
                    style: "position:fixed;width:100%;height:80%;",
                    content: [
                        {
                            type: "div",
                            extend: {
                                class: ".testclass"
                            },
                            content: [
                                {
                                    type: "h1",
                                    content: "Window Title",
                                    id: "u"
                                }],
                            style: "position: absolute;left:" + pos.x + "px;top:" + pos.y + "px;",
                            id: "uc"
                        },
                        {
                            type: "div",
                            content: [
                                {
                                    type: "div",
                                    content: "test2",
                                    style: "color:blue;"
                                },
                                {
                                    type: "div",
                                    content: "test2"
                                },
                            ],
                            id: "test1"
                        },
                        {
                            type: "div",
                            content: "test2",
                            id: "test2"
                        },
                        {
                            type: "div",
                            content: "test3",
                            id: "test3"
                        },
                        {
                            type: "div",
                            content: "test4",
                            id: "test4"
                        },
                    ],
                    id: "main"
                },

            ];
            return elements;
        }

        const facilitymanager = new FacilityManager(
            new EventManager((x) => {
                if (x !== undefined)
                    facilitymanager.renderTree(x, facilitymanager.models.find((y) => y.name === x).model.get())
            }),
            new ActionManager(),
            new DomManager(),
            null
        );

        //facilitymanager.addView({
        //    name: "main",
        //    rootElementId: "app",
        //    render: (x) => getDom(x),
        //    events: [],
        //    model: {
        //        x: 0,
        //        y: 0
        //    }
        //});
        const windowtest = getWindowView("app2","window1", 200, 400, "Help", "Textinhalt", "---");
        facilitymanager.addView(windowtest);

        facilitymanager.addActions([{
            actionName: "window1_mousemove",
            listeners: [
                (x) => {
                    x.preventDefault();
                    facilitymanager.getAndSetModel("window1", (m) => {
                        return {
                            ...m,
                            x: m.x + x.clientX - m.xOld,
                            y: m.y + x.clientY - m.yOld,
                            xOld: x.clientX,
                            yOld: x.clientY,
                        }
                    });
                },
            ]
        }, {
                actionName: "window1_mousemove2",
            listeners: [
                (x) => {
                    x.preventDefault();
                    facilitymanager.getAndSetModel("window1", (m) => {
                        return {
                            ...m,
                            width: (m.width + x.clientX - m.xOld2) < 180 ? 180 : (m.width + x.clientX - m.xOld2),
                            height: (m.height + x.clientY - m.yOld2) < 180 ? 180 : (m.height + x.clientY - m.yOld2),
                            xOld2: x.clientX,
                            yOld2: x.clientY,
                        }
                    });
                },
            ]
        }, {
                actionName: "window1_mousedown",
            listeners: [
                (x) => {
                    x.preventDefault();
                    facilitymanager.eventManager.changeEventActivity("window1_mousemove", true);
                    facilitymanager.getAndSetModel("window1", (m) => {
                        return {
                            ...m,
                            xOld: x.clientX,
                            yOld: x.clientY,
                        }
                    }) },
            ]
        }, {
                actionName: "window1_mousedown2",
            listeners: [
                (x) => {
                    x.preventDefault();
                    facilitymanager.eventManager.changeEventActivity("window1_mousemove2", true);
                    facilitymanager.getAndSetModel("window1", (m) => {
                        return {
                            ...m,
                            xOld2: x.clientX,
                            yOld2: x.clientY,
                        }
                    })
                },
            ]
        }, {
                actionName: "window1_mouseup",
            listeners: [
                () => {
                    facilitymanager.eventManager.changeEventActivity("window1_mousemove", false);
                    facilitymanager.eventManager.changeEventActivity("window1_mousemove2", false);
                },
            ]
        }
        ]);
        facilitymanager.renderTree("window1");
        //facilitymanager.renderTree("main");
    </script>
</body>
</html>